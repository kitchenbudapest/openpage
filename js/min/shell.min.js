var g=g||{};(function(){"use strict";var PRINTABLES=g.font.VT220.printables;function Shell(frame,context,distort){this._INTRO=["  ##########","  ##      ##  KITCHEN","  ##      ##  BUDAPEST","  ##      ##  Powered by *T**","  ##########",""];this._PS1="[visitor@kibu ~] $ ";this._index=0;this._history=[""];this._scr=new g.scr.Screen({context:context,fontFace:g.font.VT220,screenWidth:41,screenHeight:10,horizontalOffset:1.5,verticalOffset:.85,backgroundColor0:"#303030",backgroundColor1:"#080808",foregroundColor:[194,255,206],foregroundGlowColor:[154,254,174],foregroundGlowRadius:3,postProcessor:distort});this._std={io:{setReader:function(reader){this._readerHistory="";this._reader=reader}.bind(this),write:this._scr.write.bind(this._scr),writeLine:function(text){this._scr.write(text);this._scr.newLine()}.bind(this)},lib:{yesOrNo:function(input){switch(input){case"":case"y":case"Y":case"yes":case"Yes":case"YES":return true;case"n":case"N":case"no":case"No":case"NO":return false;default:this._scr.write("Invalid input: "+input);this._scr.newLine();return null}}.bind(this),invalidArg:function(command,option){this._scr.write(command+": unrecognized option '"+option+"'");this._scr.newLine();this._scr.write("Try 'man "+command+"' for more information");this._scr.newLine()}.bind(this),openPopUp:function(url){var urlOpener=function(){window.open(url);frame.removeEventListener("click",urlOpener,false);this._urlOpener=undefined};if(this._urlOpener)frame.removeEventListener("click",this._urlOpener,false);frame.addEventListener("click",urlOpener,false);this._urlOpener=urlOpener;this._scr.newLine();this._scr.write("==> CLICK HERE TO OPEN LINK!");this._scr.newLine();this._scr.newLine()}.bind(this)}};this._resetAndWriteMultiLine(this._INTRO);this._scr.write(this._PS1);this._scr.render()}Shell.prototype.onKeyDown=function(event){switch(event.which||event.keyCode){case g.kb.code.Return:this._scr.newLine();if(this._reader){if(!this._reader(this._std,this._readerHistory)){this._reader=undefined;this._scr.write(this._PS1)}this._readerHistory=""}else{this._execute(this._history[this._index++]);this._history[this._index]=""}break;case g.kb.code.BackSpace:var line=this._history[this._index];line=line.slice(0,line.length-1);this._history[this._index]=line;this._scr.popChar(1);break;default:return}this._scr.render();event.preventDefault()};Shell.prototype.onKeyPress=function(event){var scr=this._scr,char=String.fromCharCode(event.which||event.keyCode);if(!(event.ctrlKey||event.altKey||event.metaKey))event.preventDefault();if(PRINTABLES.indexOf(char)===-1)return;if(this._reader)this._readerHistory+=char;else this._history[this._index]+=char;scr.write(char);scr.render()};Shell.prototype._resetAndWriteMultiLine=function(msg){var scr=this._scr;scr.reset();for(var i=0;i<msg.length;i++){scr.write(msg[i]);scr.newLine()}};Shell.prototype._poweroff=function(argv){var scr=this._scr;scr.write("VT100 is rebooting now...");scr.newLine();scr.write("See you on the other side!");this._resetAndWriteMultiLine(this._INTRO)};Shell.prototype._execute=function(input){var program,argv=input.split(" "),command=argv[0];argv.shift();switch(command){case"":break;case"del":case"clean":case"clear":case"reset":this._scr.reset();break;case"kill":case"halt":case"reboot":case"shutdown":case"poweroff":program=this._poweroff.bind(this);break;case"skip":case"exit":case"quit":case"close":case"break":case"leave":break;case"ls":case"help":case"info":case"more":program=g.bin("help").main;break;case"join":case"apply":case"register":program=g.bin("apply").main;break;case"doc":case"docs":case"wiki":case"document":case"documents":case"hackathon":program=g.bin("doc").main;break;case"addr":case"address":case"location":program=g.bin("addr").main;break;case"date":case"time":case"calendar":program=g.bin("date").main;break;case"award":case"prize":case"winner":case"victory":program=g.bin("award").main;break;case"_":case".help":case"hidden":program=g.bin("hidden").main;break;case"man":program=g.bin("man").main;break;case"kibu":case"kitchen":case"kitchenbudapest":program=g.bin("kibu").main;break;case"git":case"repo":case"github":case"repository":case"opensource":program=g.bin("git").main;break;case"what":case"vt100":case"VT100":program=g.bin("what").main;break;case"get":case"fork":case"patch":program=g.bin("fork").main;break;case"su":case"sudo":case"author":program=g.bin("su").main;break;case"42":case"fortytwo":program=g.bin("42").main;break;case"zoom":program=g.bin("zoom").main;break;case"span":case"line":program=g.bin("line").main;break;default:this._scr.write("shell: "+command+": command not found");this._scr.newLine();break}if(program)program(this._std,argv);if(!this._reader){this._scr.write(this._PS1);this._scr.render()}};g.shell={Shell:Shell}})();